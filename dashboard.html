<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SignalScout AI Dashboard</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

  <style>
    body { font-family: 'Inter', sans-serif; background-color: #0B1120; color: #cbd5e1; }
    .signal-card { background-color: #1E293B; border: 1px solid #334155; }
    .signal-card:hover { border-color: #3b82f6; transform: translateY(-4px); transition: all 0.2s; }
    .signal-card blockquote { border-left: 3px solid #3b82f6; padding-left: 1.5rem; color: #d1d5db; font-style: italic; }
    .signal-type-badge { font-size: 0.75rem; font-weight: 500; padding: 0.25rem 0.75rem; border-radius: 9999px; background-color: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.5); }
    .choices__inner { background-color: #1E293B; color: white; border-color: #334155; }
    .choices__list--dropdown, .choices__list[aria-expanded] { background-color: #1E293B; color: white; }
    .choices__item--selectable { color: white; }
    .filter-group label { color: #94a3b8; font-size: 0.9rem; margin-bottom: 0.25rem; display: block; }
  </style>
</head>
<body class="bg-gray-900 text-gray-300">
  <header class="w-full p-6 flex justify-between items-center container mx-auto border-b border-gray-800">
    <a href="/" class="text-xl font-bold text-white">SignalScout AI</a>
    <nav class="flex items-center space-x-6 text-sm">
      <a href="privacy-policy.html" class="text-gray-400 hover:text-white">Privacy</a>
      <a href="terms-of-service.html" class="text-gray-400 hover:text-white">T&C</a>
      <a href="#" data-ms-action="profile" class="btn-secondary py-2 px-4 rounded-lg">Account</a>
      <a href="#" data-ms-action="logout" class="text-gray-400 hover:text-white">Log Out</a>
    </nav>
  </header>

  <main class="container mx-auto px-6 py-10">
    <h1 class="text-4xl font-bold text-white mb-8">Your Signal Feed</h1>

    <!-- Filters -->
    <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-6" id="filters"></div>

    <div class="mb-6">
      <button onclick="clearFilters()" class="text-sm text-blue-400 border border-blue-400 px-4 py-2 rounded hover:bg-blue-400 hover:text-white">Clear Filters</button>
    </div>

    <div id="signal-feed" class="flex flex-wrap -mx-3"></div>
  </main>

  <footer class="text-center py-10 px-6 border-t border-gray-800 text-gray-500 text-sm">
    <div class="space-x-6 mb-4">
      <a href="./terms-of-service.html" class="hover:text-white">Terms of Service</a>
      <a href="./privacy-policy.html" class="hover:text-white">Privacy Policy</a>
    </div>
    <p>&copy; 2025 SignalScout AI. All rights reserved.</p>
  </footer>

  <script data-memberstack-app="app_cmfu0bt8h002n0wubdfa67lp6" src="https://static.memberstack.com/scripts/v1/memberstack.js" type="text/javascript"></script>

  <script>
    const API_KEY = 'patQZunGJdbMIjNaG.388cc8dfbf3fae8e01d98bd7d112f8fd3476c62131361cc65abedafdfe51afb0';
    const BASE_ID = 'appLmGqJQ0olQo4es';
    const TABLE_NAME = 'Signals';
    const container = document.getElementById('signal-feed');
    const filtersDiv = document.getElementById('filters');

    let allData = [], choicesInstances = {};

    const fieldsToFilter = ['Person', 'Title', 'Company', 'Source Name'];

    function createSignalCard(signal) {
      const person = signal.Person || 'N/A';
      const title = signal.Title || 'No Title';
      const company = signal.Company || 'No Company';
      const quote = signal.Quote || 'No Quote Available';
      const sourceName = signal['Source Name'] || 'Unknown Source';
      const sourceUrl = signal['Source URL'] || '#';
      const sourceType = signal['Source Type'] || '';
      const rawDate = signal['Publication Date'];
      const pubDate = rawDate ? new Date(rawDate).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' }) : '';

      return `<div class="w-full md:w-1/2 lg:w-1/3 px-3 mb-6 signal-card-wrapper">
        <div class="signal-card p-6 rounded-2xl h-full flex flex-col justify-between">
          <div class="flex justify-between items-start mb-4">
            <div>
              <p class="text-white font-bold text-lg">${person}</p>
              <p class="text-sm text-gray-400">${title} at ${company}</p>
            </div>
            ${sourceType ? `<div class="signal-type-badge">${sourceType}</div>` : ''}
          </div>
          <blockquote class="mb-4">"${quote}"</blockquote>
          <div class="pt-4 border-t border-gray-700 flex justify-between items-center">
            <a href="${sourceUrl}" target="_blank" class="text-blue-400 text-sm font-semibold hover:text-blue-300">View Source â†’</a>
            ${pubDate ? `<span class="text-xs text-gray-500">${pubDate}</span>` : ''}
          </div>
        </div>
      </div>`;
    }

    function renderCards(data) {
      container.innerHTML = data.map(createSignalCard).join('');
      new Masonry(container, { itemSelector: '.signal-card-wrapper', percentPosition: true });
    }

    function setupFilters(data) {
      filtersDiv.innerHTML = '';
      fieldsToFilter.forEach(field => {
        const unique = [...new Set(data.map(d => d[field]).filter(Boolean))].sort();
        const wrapper = document.createElement('div');
        wrapper.className = 'filter-group';
        wrapper.innerHTML = `<label>${field}</label><select id="filter-${field}" multiple></select>`;
        filtersDiv.appendChild(wrapper);

        const select = wrapper.querySelector('select');
        unique.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v; opt.textContent = v;
          select.appendChild(opt);
        });

        const choice = new Choices(select, { removeItemButton: true, placeholder: true, placeholderValue: `Select ${field}` });
        choicesInstances[field] = choice;
        select.addEventListener('change', applyFilters);
      });
    }

    function applyFilters() {
      let filtered = [...allData];
      fieldsToFilter.forEach(field => {
        const selected = choicesInstances[field].getValue(true);
        if (selected.length) {
          filtered = filtered.filter(d => selected.includes(d[field]));
        }
      });
      renderCards(filtered);
    }

    function clearFilters() {
      Object.values(choicesInstances).forEach(c => c.clearStore());
      renderCards(allData);
    }

    async function fetchSignals() {
      const url = `https://api.airtable.com/v0/${BASE_ID}/${TABLE_NAME}?sort[0][field]=Publication%20Date&sort[0][direction]=desc`;
      const res = await fetch(url, { headers: { Authorization: `Bearer ${API_KEY}` } });
      const json = await res.json();
      const records = json.records.map(r => r.fields);
      allData = records;
      renderCards(records);
      setupFilters(records);
    }

    if (window.MemberStack && MemberStack.onReady) {
  MemberStack.onReady.then(member => {
    console.log("MemberStack ready");
    fetchSignals();
  });
} else {
  console.warn("MemberStack not available, loading anyway");
  fetchSignals();
}
  </script>
</body>
</html>